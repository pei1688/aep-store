generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//ğŸŸ¡ å•†å“
model Product {
  id          String   @id @default(uuid())
  name        String
  description String
  imgUrl      String[]
  sku         String
  brand       String?
  price       Int
  stock       Int

  hasVariants Boolean          @default(false) // æ˜¯å¦æœ‰è®Šé«”
  variants    ProductVariant[] // å•†å“è®Šé«”

  isOnSale           Boolean @default(false)
  discountPercentage Float?

  productCollections ProductCollection[]

  categoryId String
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([categoryId])
  @@map("Product")
}

// å•†å“è®Šé«”æ¨¡å‹

model ProductVariant {
  id        String  @id @default(uuid())
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  // è¦æ ¼1 (ä¸»è¦è¦æ ¼ï¼Œå¦‚é¡è‰²)
  spec1Name         String // è¦æ ¼1åç¨±ï¼Œå¦‚ "é¡è‰²"
  spec1Value        String // è¦æ ¼1å€¼ï¼Œå¦‚ "ç™½è‰²"
  spec1Image        String? // è¦æ ¼1å°æ‡‰çš„åœ–ç‰‡
  // ç•¶æ²’æœ‰è¦æ ¼2æ™‚ï¼Œåƒ¹æ ¼ã€SKUã€åº«å­˜ç›´æ¥ç¶å®šåœ¨æ­¤å±¤ç´š
  price             Int? // æ­¤è®Šé«”çš„åƒ¹æ ¼ (ç•¶æ²’æœ‰spec2æ™‚ä½¿ç”¨)
  stock             Int? // æ­¤è®Šé«”çš„åº«å­˜ (ç•¶æ²’æœ‰spec2æ™‚ä½¿ç”¨)
  sku               String? // æ­¤è®Šé«”çš„SKU (ç•¶æ²’æœ‰spec2æ™‚ä½¿ç”¨)
  // è¦æ ¼2çµ„åˆ (æ¬¡è¦è¦æ ¼ï¼Œå¦‚å°ºå¯¸)
  spec2Combinations ProductVariantSpec2[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // åŒä¸€å•†å“çš„è¦æ ¼1å€¼ä¸èƒ½é‡è¤‡
  @@unique([productId, spec1Value])
  @@map("ProductVariant")
}

// è¦æ ¼2çµ„åˆæ¨¡å‹ (å°ºå¯¸ç­‰)

model ProductVariantSpec2 {
  id        String         @id @default(uuid())
  variantId String
  variant   ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)

  spec2Name  String // è¦æ ¼2åç¨±ï¼Œå¦‚ "å°ºå¯¸"
  spec2Value String // è¦æ ¼2å€¼ï¼Œå¦‚ "S", "M", "L"

  // åƒ¹æ ¼å’Œåº«å­˜
  price Int? // æ­¤çµ„åˆçš„åƒ¹æ ¼ (NT$)
  stock Int? // æ­¤çµ„åˆçš„åº«å­˜æ•¸é‡
  sku   String? // æ­¤çµ„åˆçš„SKU (å¯é¸)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // åŒä¸€è®Šé«”çš„è¦æ ¼2å€¼ä¸èƒ½é‡è¤‡
  @@unique([variantId, spec2Value])
  @@map("ProductVariantSpec2")
}

model Collection {
  id                 String              @id @default(uuid())
  name               String
  slug               String              @unique
  image              String?
  description        String?
  productCollections ProductCollection[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("Collection")
}

model ProductCollection {
  id           String     @id @default(uuid())
  product      Product    @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId    String
  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
  collectionId String

  createdAt DateTime @default(now())

  @@index([productId])
  @@index([collectionId])
  @@map("ProductCollection")
}

model Category {
  id       String    @id @default(uuid())
  name     String    @unique
  products Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("Category")
}

//ğŸŸ¡ ç”¨æˆ¶
enum Role {
  User
  Admin
}
model User {
  id               String    @id @map("_id")
  name             String
  email            String
  emailVerified    Boolean   @default(false)
  role             Role      @default(User)
  image            String?
  createdAt        DateTime
  updatedAt        DateTime
  sessions         Session[]
  accounts         Account[]
  orders           Order[]
  Profile          Profile?
  stripeCustomerId String?

  @@unique([email])
  @@map("user")
}

model Profile {
  id          String    @id @default(uuid())
  userId      String    @unique
  email       String    @unique
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  name        String?
  phoneNumber String?
  gender      String?
  birthday    DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  Address     Address[]

  @@map("profile")
}

model Address {
  id        String  @id @default(uuid())
  profileId String
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  recipientName String // æ”¶ä»¶äººå§“å
  phoneNumber   String // æ”¶ä»¶äººé›»è©±
  zipCode       String // éƒµéå€è™Ÿï¼Œä¾‹å¦‚ 100
  county        String // ç¸£å¸‚ï¼Œä¾‹å¦‚ å°åŒ—å¸‚
  district      String // è¡Œæ”¿å€ï¼Œä¾‹å¦‚ ä¸­æ­£å€
  streetAddress String // æ”¶ä»¶åœ°å€

  isDefault Boolean  @default(false) // å¯é¸ï¼šæ˜¯å¦ç‚ºé è¨­åœ°å€
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("address")
}

model Session {
  id        String   @id @map("_id")
  expiresAt DateTime
  token     String
  createdAt DateTime
  updatedAt DateTime
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@map("session")
}

model Account {
  id                    String    @id @map("_id")
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime
  updatedAt             DateTime

  @@map("account")
}

model Verification {
  id         String    @id @map("_id")
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

//ğŸŸ¡ è¨‚å–®
model Order {
  id              String   @id @default(uuid())
  userId          String   @unique
  name            String
  phoneNumber     String
  address         String
  notes           String?
  gender          String   @default("")
  totalItems      Int
  totalPrice      Int
  paymentMethod   String
  paymentStatus   String   @default("UNPAID")
  status          String   @default("PENDING")
  stripeSessionId String?  @unique
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  orderItems OrderItem[]
  User       User        @relation(fields: [userId], references: [id])

  @@map("orders")
}

model OrderItem {
  id           String   @id @default(uuid())
  orderId      String
  productId    String
  productName  String
  productImage String
  price        Int
  quantity     Int
  variantText  String?
  variantId    String? // å•†å“è®Šé«” ID
  spec2Id      String? // è¦æ ¼2 ID
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("order_items")
}

// å¦‚æœä½ æƒ³è¦æ›´æ¸…æ¥šçš„ç‹€æ…‹ç®¡ç†ï¼Œå¯ä»¥ä½¿ç”¨ enumï¼š
enum PaymentStatus {
  UNPAID // æœªä»˜æ¬¾ï¼ˆè²¨åˆ°ä»˜æ¬¾ï¼‰
  PENDING // ä»˜æ¬¾è™•ç†ä¸­
  PAID // å·²ä»˜æ¬¾
  FAILED // ä»˜æ¬¾å¤±æ•—
  REFUNDED // å·²é€€æ¬¾
}

enum OrderStatus {
  PENDING // ç­‰å¾…ç¢ºèª
  PENDING_PAYMENT // ç­‰å¾…ä»˜æ¬¾
  CONFIRMED // å·²ç¢ºèª
  PROCESSING // è™•ç†ä¸­
  SHIPPED // å·²å‡ºè²¨
  DELIVERED // å·²é€é”
  CANCELLED // å·²å–æ¶ˆ
  REFUNDED // å·²é€€æ¬¾
}
